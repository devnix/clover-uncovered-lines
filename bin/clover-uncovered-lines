#!/usr/bin/env php
<?php

declare(strict_types=1);

require __DIR__ . '/../vendor/autoload.php';

use Devnix\CloverUncoveredLines\CloverUncoveredLinesParser;
use Devnix\CloverUncoveredLines\OutputFormatter;

/**
 * Parse Clover coverage XML and extract uncovered lines.
 * Usage: bin/clover-uncovered-lines <path/to/clover.xml>
 */

if (!isset($argv[1])) {
    fwrite(STDERR, "Error: Missing required argument\n");
    fwrite(STDERR, "Usage: {$argv[0]} <path/to/clover.xml>\n");
    exit(1);
}

$cloverPath = $argv[1];

$parser = new CloverUncoveredLinesParser();
$formatter = new OutputFormatter();

try {
    $uncoveredByFile = $parser->parse($cloverPath);
    echo $formatter->format($uncoveredByFile);
    exit(empty($uncoveredByFile) ? 0 : 1);
} catch (RuntimeException $e) {
    fwrite(STDERR, "Error: {$e->getMessage()}\n");
    exit(1);
}
